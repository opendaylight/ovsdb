{
  "comments": [
    {
      "key": {
        "uuid": "7a6b29fe_a4c93c7a",
        "filename": "southbound/southbound-impl/src/main/java/org/opendaylight/ovsdb/southbound/transactions/md/TransactionInvokerImpl.java",
        "patchSetId": 1
      },
      "lineNbr": 38,
      "author": {
        "id": 65
      },
      "writtenOn": "2016-08-22T22:57:47Z",
      "side": 1,
      "message": "TransactionInvokerImpl is the main class that actually process all the md-sal transactions for all the nodes. So size of 20 is something that is very less to show up the warning, given that the queue size is 10000 here. This warning will show up even if you connect 2 ovs switches. I think with this size, it will log this warning message very frequently to the log file. I think you will see this impact if you connect 3 ovsdb node with 3 bridge each. I think we should keep this number a bit high 100+ or 50% of the queue size or probably configurable parameter. In my personal opinion if we can dump the DEBUG logs about the queue size rather than warning message (which user can interpret in many ways), that would be better approach to hint user about the possible bottleneck issue.\n On a side node this is one of the bottleneck class in the whole switch message processing pipeline, because it uses single thread to process these messages.",
      "range": {
        "startLine": 38,
        "startChar": 29,
        "endLine": 38,
        "endChar": 62
      },
      "revId": "07c855804bed96946d724802546860b2fc6c2894",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7a6b29fe_84a9a07d",
        "filename": "southbound/southbound-impl/src/main/java/org/opendaylight/ovsdb/southbound/transactions/md/TransactionInvokerImpl.java",
        "patchSetId": 1
      },
      "lineNbr": 38,
      "author": {
        "id": 396
      },
      "writtenOn": "2016-08-22T23:45:54Z",
      "side": 1,
      "message": "Yes, this should be configurable parameter in the future, probably in a different patch.\n\nI don\u0027t think 20 is \"very\" less to show up the warning. I\u0027ve checked many log files which have debug log messages which show the size of the queue. And, I think when it goes over 20, it means that we are facing a performance issue, and it means that we are probably hitting the bug 5376. To avoid such kind of performance issues and critical problems, the plugin should process update notifications as quickly as the plugin receives update notification. So I would say that the size should be less than 1.\n\nYes, now, we would observe that the size goes over 20 easily. That\u0027s because the plugin has performance issue (e.g. the bug 6475). The situation which the size goes over 20 should be avoided.\n\nAnd, I think we should output log messages at WARN level, because it would tell users that a performance issue happens which I think users need to know. That\u0027s really valuable information for users. Otherwise, users would just hit critical problem like bug 5376 without any hits about why the critical problem happened.\n\nYes, some users can see messages at DEBUG level. However, DEBUG level is for developers. So I don\u0027t think we should expect users see DEBUG messages. Messages which should be informed to users are not output at the DEBUG level.",
      "parentUuid": "7a6b29fe_a4c93c7a",
      "range": {
        "startLine": 38,
        "startChar": 29,
        "endLine": 38,
        "endChar": 62
      },
      "revId": "07c855804bed96946d724802546860b2fc6c2894",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7a6b29fe_a507761b",
        "filename": "southbound/southbound-impl/src/main/java/org/opendaylight/ovsdb/southbound/transactions/md/TransactionInvokerImpl.java",
        "patchSetId": 1
      },
      "lineNbr": 38,
      "author": {
        "id": 396
      },
      "writtenOn": "2016-08-23T15:52:45Z",
      "side": 1,
      "message": "Based on your opinion and our latest observations, I\u0027ve updated the value from 20 to 50.\n\nI\u0027ve checked how many TransactionCommand pending would be in the inputQueue with the latest source code.\nThe max number was 11 during our test with the legacy NetVirt feature.\nIn the test, we created two networks and one VM instance  in OpenStack.\nAnd, there were over 500 update notification came from OVS during the test.\nIn the test, we used the source code at stable/beryllium branch. Though I think the number will be not much different even in stable/boron branch.\nThe test was done with three ODL nodes as a cluster.\nAt most, there was 11 TransactionCommand in the inputQueue in the node which was the owner for three OVS, but not the leader of the shard-topology-operational. (Different ODL node was the leader of the shard-topology-operational). That is the worst case in terms of the performance on processing update notifications. Therefore, I think *50* is a good number as a threshold at which we warn users that a performance issue is happening.",
      "parentUuid": "7a6b29fe_84a9a07d",
      "range": {
        "startLine": 38,
        "startChar": 29,
        "endLine": 38,
        "endChar": 62
      },
      "revId": "07c855804bed96946d724802546860b2fc6c2894",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7a6b29fe_da27f0b4",
        "filename": "southbound/southbound-impl/src/main/java/org/opendaylight/ovsdb/southbound/transactions/md/TransactionInvokerImpl.java",
        "patchSetId": 1
      },
      "lineNbr": 38,
      "author": {
        "id": 65
      },
      "writtenOn": "2016-08-23T21:02:30Z",
      "side": 1,
      "message": "Performance is always dependent on where you are running the controller. If you are running the controller in 1 CPU/2gig ram, you probably will hit 50 very easily, but if you are running it in 8CPU/16gig machine, you might never hit this number. In some cases you can hit this number even with 8CPU/16gig machine if ovsdb is loaded with other project that does huge number of data store transaction. But that does not really mean that plugin is a culprit here, it\u0027s because md-sal itself is loaded. So these explicit warning message can give you the wrong clue about the real problem. So there is a possibility that the warning message is really a false positive. So in my opinion, it\u0027s a better approach to print the status (queue size and any other stats) in debug log rather than explicitly warning the user, which can be false positive. Thoughts?",
      "parentUuid": "7a6b29fe_a507761b",
      "range": {
        "startLine": 38,
        "startChar": 29,
        "endLine": 38,
        "endChar": 62
      },
      "revId": "07c855804bed96946d724802546860b2fc6c2894",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    }
  ]
}