{
  "comments": [
    {
      "key": {
        "uuid": "9a3d3df0_011a9d7c",
        "filename": "openstack/net-virt/src/main/java/org/opendaylight/ovsdb/openstack/netvirt/impl/NeutronL3Adapter.java",
        "patchSetId": 2
      },
      "lineNbr": 433,
      "author": {
        "id": 773
      },
      "writtenOn": "2016-02-10T17:42:54Z",
      "side": 1,
      "message": "nitpick: use the // comment on one line",
      "revId": "9aa71675db827cbf28954b63423c0919f4e37e90",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9a3d3df0_45c0307c",
        "filename": "openstack/net-virt/src/main/java/org/opendaylight/ovsdb/openstack/netvirt/impl/NeutronL3Adapter.java",
        "patchSetId": 2
      },
      "lineNbr": 433,
      "author": {
        "id": 2029
      },
      "writtenOn": "2016-02-10T19:23:01Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "9a3d3df0_011a9d7c",
      "revId": "9aa71675db827cbf28954b63423c0919f4e37e90",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9a3d3df0_e11cd979",
        "filename": "openstack/net-virt/src/main/java/org/opendaylight/ovsdb/openstack/netvirt/impl/NeutronL3Adapter.java",
        "patchSetId": 2
      },
      "lineNbr": 1461,
      "author": {
        "id": 773
      },
      "writtenOn": "2016-02-10T17:42:54Z",
      "side": 1,
      "message": "sonar nitpick: add the space between if and (",
      "range": {
        "startLine": 1461,
        "startChar": 8,
        "endLine": 1461,
        "endChar": 10
      },
      "revId": "9aa71675db827cbf28954b63423c0919f4e37e90",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9a3d3df0_a5bf7cfa",
        "filename": "openstack/net-virt/src/main/java/org/opendaylight/ovsdb/openstack/netvirt/impl/NeutronL3Adapter.java",
        "patchSetId": 2
      },
      "lineNbr": 1461,
      "author": {
        "id": 2029
      },
      "writtenOn": "2016-02-10T19:23:01Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "9a3d3df0_e11cd979",
      "range": {
        "startLine": 1461,
        "startChar": 8,
        "endLine": 1461,
        "endChar": 10
      },
      "revId": "9aa71675db827cbf28954b63423c0919f4e37e90",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9a3d3df0_2117e152",
        "filename": "openstack/net-virt/src/main/java/org/opendaylight/ovsdb/openstack/netvirt/impl/NeutronL3Adapter.java",
        "patchSetId": 2
      },
      "lineNbr": 1463,
      "author": {
        "id": 773
      },
      "writtenOn": "2016-02-10T17:42:54Z",
      "side": 1,
      "message": "this should be just equals and not ignoreCase, but it is fine since this code is probably used all over this way.",
      "range": {
        "startLine": 1463,
        "startChar": 52,
        "endLine": 1463,
        "endChar": 68
      },
      "revId": "9aa71675db827cbf28954b63423c0919f4e37e90",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9a3d3df0_85ba3808",
        "filename": "openstack/net-virt/src/main/java/org/opendaylight/ovsdb/openstack/netvirt/impl/NeutronL3Adapter.java",
        "patchSetId": 2
      },
      "lineNbr": 1463,
      "author": {
        "id": 2029
      },
      "writtenOn": "2016-02-10T19:23:01Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "9a3d3df0_2117e152",
      "range": {
        "startLine": 1463,
        "startChar": 52,
        "endLine": 1463,
        "endChar": 68
      },
      "revId": "9aa71675db827cbf28954b63423c0919f4e37e90",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9a3d3df0_c14a75c4",
        "filename": "openstack/net-virt/src/main/java/org/opendaylight/ovsdb/openstack/netvirt/impl/NeutronL3Adapter.java",
        "patchSetId": 2
      },
      "lineNbr": 1464,
      "author": {
        "id": 5357
      },
      "writtenOn": "2016-02-10T16:10:49Z",
      "side": 1,
      "message": "I could be missing something but I couldn\u0027t find where getFloatingIPAdress() is used in the delete code path anywhere except in logging statements. If this is correct,  I would say it is better to not set that value value to null so that it shows up in log statements and makes them a little more readable. +1\u0027ing anyway since not really functional.",
      "range": {
        "startLine": 1464,
        "startChar": 20,
        "endLine": 1464,
        "endChar": 83
      },
      "revId": "9aa71675db827cbf28954b63423c0919f4e37e90",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9a3d3df0_61d729c0",
        "filename": "openstack/net-virt/src/main/java/org/opendaylight/ovsdb/openstack/netvirt/impl/NeutronL3Adapter.java",
        "patchSetId": 2
      },
      "lineNbr": 1464,
      "author": {
        "id": 2029
      },
      "writtenOn": "2016-02-10T16:36:32Z",
      "side": 1,
      "message": "Hi Joshua,\nThanks for the review.\n\nYes, you are correct, I can take this out.\n\nIn the delete code, there is this check:\n\n   if (neutronFloatingIP.getFixedIPAddress() \u003d\u003d null) {\n            action \u003d Action.DELETE;\n        } else {\n            action \u003d actionIn;\n        }\n\n\nwhich I was attempting to address. But, as you correctly observed, setting floating ip address to null is not needed. I will removed these lines.\n\nThanks",
      "parentUuid": "9a3d3df0_c14a75c4",
      "range": {
        "startLine": 1464,
        "startChar": 20,
        "endLine": 1464,
        "endChar": 83
      },
      "revId": "9aa71675db827cbf28954b63423c0919f4e37e90",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9a3d3df0_a102d108",
        "filename": "openstack/net-virt/src/main/java/org/opendaylight/ovsdb/openstack/netvirt/impl/NeutronL3Adapter.java",
        "patchSetId": 2
      },
      "lineNbr": 1464,
      "author": {
        "id": 773
      },
      "writtenOn": "2016-02-10T17:42:54Z",
      "side": 1,
      "message": "Agree with Josh, I think this should be left out. This is cache is set by the neutron IAware translater stuff and is not like the other netvirt caches that netvirt owns. Netvirt should just be a reader of this cache. When the floating ip is deleted then the translater should update the cache.\n\nBut that gives me another question: why don\u0027t we see an floating ip update when the vm is deleted? We know the floating ip has been updated over in neutron since the neutron floatingip-list command shows the port has been removed from the floating ip, so why is there not an event there? Does neutron not send an event or is the ODL neutron code not handling the event?",
      "parentUuid": "9a3d3df0_61d729c0",
      "range": {
        "startLine": 1464,
        "startChar": 20,
        "endLine": 1464,
        "endChar": 83
      },
      "revId": "9aa71675db827cbf28954b63423c0919f4e37e90",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9a3d3df0_05aaa8d3",
        "filename": "openstack/net-virt/src/main/java/org/opendaylight/ovsdb/openstack/netvirt/impl/NeutronL3Adapter.java",
        "patchSetId": 2
      },
      "lineNbr": 1464,
      "author": {
        "id": 2029
      },
      "writtenOn": "2016-02-10T18:51:41Z",
      "side": 1,
      "message": "Thanks Sam. I\u0027m removing these lines.\n\nAccording to Neutron folks, we should not expect a floating ip to be deleted when a port is deleted. Part of email from Miguel below, and my response, included.\n\nI\u0027ll take a closer look to see if ODL neutron code is not handling some event, but my debugging indicates only neutron port delete event being received.\n\n\u003e\n\u003e It seems like Miguel\u0027s suggestions below would work.\n\u003e\n\u003e I do have a question regarding #2. Does neutron send an event/notification when a floating IP is disassociated from a port? When debugging earlier, all I observed was a port delete event.\n\n\nI actually don’t know, and probably you’re right. I’d guess that, speaking of the MechanismDriver API [1] if it happens, it should be in the port_update events.\n\n\n[1] https://github.com/openstack/neutron/blob/master/neutron/plugins/ml2/driver_api.py#L549\n\n\u003e\n\u003e Thanks,\n\u003e Vic\n\u003e\n\u003e\u003e What Jakub said is correct,\n\u003e\u003e\n\u003e\u003e Once you got the floating IP allocated, you have to explicitly return it\n\u003e\u003e if you don’t want it anymore.\n\u003e\u003e\n\u003e\u003e That happens because you may want to start another server and keep\n\u003e\u003e the floating IP which could have associated DNS records, and you don’t\n\u003e\u003e want to go back to your DNS to repoint it because you got a different IP address.\n\u003e\u003e\n\u003e\u003e You may delete the corresponding floating IP OF rules for a port if:\n\u003e\u003e  1) the port is deleted, or,\n\u003e\u003e  2) if the floating IP is dissociated from such port.\n\u003e\u003e\n\u003e\u003e But you shall not expect a floating ip to be deleted if the port is deleted.\n\u003e\u003e\n\u003e\u003e I hope it helps,\n\u003e\u003e\n\u003e\u003e Cheers,\n\u003e\u003e Miguel Ángel Ajo.",
      "parentUuid": "9a3d3df0_a102d108",
      "range": {
        "startLine": 1464,
        "startChar": 20,
        "endLine": 1464,
        "endChar": 83
      },
      "revId": "9aa71675db827cbf28954b63423c0919f4e37e90",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9a3d3df0_e53864a2",
        "filename": "openstack/net-virt/src/main/java/org/opendaylight/ovsdb/openstack/netvirt/impl/NeutronL3Adapter.java",
        "patchSetId": 2
      },
      "lineNbr": 1464,
      "author": {
        "id": 2029
      },
      "writtenOn": "2016-02-10T19:23:01Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "9a3d3df0_c14a75c4",
      "range": {
        "startLine": 1464,
        "startChar": 20,
        "endLine": 1464,
        "endChar": 83
      },
      "revId": "9aa71675db827cbf28954b63423c0919f4e37e90",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    }
  ]
}